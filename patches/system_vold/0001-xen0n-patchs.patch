From a59b845ebe07b027e3c525c3794ca81ee63320c9 Mon Sep 17 00:00:00 2001
From: Wang Xuerui <idontknw.wang@gmail.com>
Date: Fri, 3 Nov 2017 13:29:40 +0300
Subject: [PATCH] xen0n patchs

Change-Id: Ia33bcb7cc473c89752901ec83e8eff8c15f5546b
---
 Android.mk          | 2 +-
 CommandListener.cpp | 2 +-
 VolumeManager.cpp   | 8 ++++++++
 3 files changed, 10 insertions(+), 2 deletions(-)

diff --git a/Android.mk b/Android.mk
index 8c0cf3d..138d55b 100644
--- a/Android.mk
+++ b/Android.mk
@@ -76,7 +76,7 @@ common_static_libraries := \
 	libz
 
 vold_conlyflags := -std=c11
-vold_cflags := -Werror -Wall -Wno-missing-field-initializers -Wno-unused-variable -Wno-unused-parameter
+vold_cflags := -Werror -Wall -Wno-missing-field-initializers -Wno-unused-variable -Wno-unused-parameter -DPARTITION_DEBUG
 
 ifeq ($(TARGET_KERNEL_HAVE_EXFAT),true)
 vold_cflags += -DCONFIG_KERNEL_HAVE_EXFAT
diff --git a/CommandListener.cpp b/CommandListener.cpp
index 5052da9..8c3efe0 100644
--- a/CommandListener.cpp
+++ b/CommandListener.cpp
@@ -48,7 +48,7 @@
 #include "MoveTask.h"
 #include "TrimTask.h"
 
-#define DUMP_ARGS 0
+#define DUMP_ARGS 1
 
 CommandListener::CommandListener() :
                  FrameworkListener("vold", true) {
diff --git a/VolumeManager.cpp b/VolumeManager.cpp
index 2f623ef..b81d0ca 100755
--- a/VolumeManager.cpp
+++ b/VolumeManager.cpp
@@ -288,6 +288,14 @@ void VolumeManager::handleBlockEvent(NetlinkEvent *evt) {
 
     if (devType != "disk") return;
 
+#ifdef MTK_HARDWARE
+    std::string devName(evt->findParam("DEVNAME"));
+    if (devName == "mmcblk0boot0" || devName == "mmcblk0boot1" || devName == "mmcblk0rpmb") {
+        LOG(DEBUG) << "Ignoring MTK raw partition " << devName;
+        return;
+    }
+#endif
+
     int major = atoi(evt->findParam("MAJOR"));
     int minor = atoi(evt->findParam("MINOR"));
     dev_t device = makedev(major, minor);
-- 
2.7.4

