From 8287846f84c18f31a4c5b81f1d9e913f594e95ec Mon Sep 17 00:00:00 2001
From: vgdn1942 <vgdn1942@gmail.com>
Date: Wed, 11 Oct 2017 00:46:11 +0300
Subject: [PATCH] Fix keyguard after lock

Change-Id: I1dc22dfff1159830f43ff2a72fad4aa94766e73d
---
 .../src/com/android/systemui/keyguard/KeyguardViewMediator.java   | 8 ++++++++
 1 file changed, 8 insertions(+)

diff --git a/packages/SystemUI/src/com/android/systemui/keyguard/KeyguardViewMediator.java b/packages/SystemUI/src/com/android/systemui/keyguard/KeyguardViewMediator.java
index 584bb91..3b940ae 100755
--- a/packages/SystemUI/src/com/android/systemui/keyguard/KeyguardViewMediator.java
+++ b/packages/SystemUI/src/com/android/systemui/keyguard/KeyguardViewMediator.java
@@ -426,6 +426,7 @@ public class KeyguardViewMediator extends SystemUI {
                         // flicker while turning back on the screen and disabling the keyguard again).
                         if (DEBUG) Log.d(TAG, "screen is off and call ended, let's make sure the "
                                 + "keyguard is showing");
+                        SystemClock.sleep(1000);
                         doKeyguardLocked(null);
                     }
                 }
@@ -468,6 +469,7 @@ public class KeyguardViewMediator extends SystemUI {
                                 if (DEBUG) Log.d(TAG, "ICC_ABSENT isn't showing,"
                                         + " we need to show the keyguard since the "
                                         + "device isn't provisioned yet.");
+                                SystemClock.sleep(1000);
                                 doKeyguardLocked(null);
                             } else {
                                 resetStateLocked();
@@ -481,6 +483,7 @@ public class KeyguardViewMediator extends SystemUI {
                         if (!isShowing()) {
                             if (DEBUG) Log.d(TAG, "INTENT_VALUE_ICC_LOCKED and keygaurd isn't "
                                     + "showing; need to show keyguard so user can enter sim pin");
+                            SystemClock.sleep(1000);
                             doKeyguardLocked(null);
                         } else {
                             resetStateLocked();
@@ -492,6 +495,7 @@ public class KeyguardViewMediator extends SystemUI {
                         if (!isShowing()) {
                             if (DEBUG) Log.d(TAG, "PERM_DISABLED and "
                                   + "keygaurd isn't showing.");
+                            SystemClock.sleep(1000);
                             doKeyguardLocked(null);
                         } else {
                             if (DEBUG) Log.d(TAG, "PERM_DISABLED, resetStateLocked to"
@@ -923,6 +927,7 @@ public class KeyguardViewMediator extends SystemUI {
                 mUpdateMonitor.setAlternateUnlockEnabled(true);
             }
 
+            SystemClock.sleep(1000);
             doKeyguardLocked(null);
         }
         // Most services aren't available until the system reaches the ready state, so we
@@ -968,6 +973,7 @@ public class KeyguardViewMediator extends SystemUI {
                    || (why == WindowManagerPolicy.OFF_BECAUSE_OF_USER && !lockImmediately)) {
                 doKeyguardLaterLocked();
             } else {
+                SystemClock.sleep(1000);
                 doKeyguardLocked(null);
             }
         }
@@ -1007,6 +1013,7 @@ public class KeyguardViewMediator extends SystemUI {
         if (timeout <= 0) {
             // Lock now
             mSuppressNextLockSound = true;
+            SystemClock.sleep(1000);
             doKeyguardLocked(null);
         } else {
             // Lock in the future
@@ -1545,6 +1552,7 @@ public class KeyguardViewMediator extends SystemUI {
                     if (mDelayedShowingSequence == sequence) {
                         // Don't play lockscreen SFX if the screen went off due to timeout.
                         mSuppressNextLockSound = true;
+                        SystemClock.sleep(1000);
                         doKeyguardLocked(null);
                     }
                 }
-- 
2.7.4

